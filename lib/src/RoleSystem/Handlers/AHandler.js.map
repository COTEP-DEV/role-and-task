{"version":3,"sources":["../../../../src/RoleSystem/Handlers/AHandler.es6"],"names":["AHandler","data","something","idSomething","args","funcToCall","PromiseCommandPattern","func","Errors","elem","find","x","id","obj","call","genericAskingSomethingToDoSomething","objToStop","reduce","tmp","isActive","push","Utils","recursiveCallFunction","context","stopSomething","objToIterate","nameToSend","nameTakenInDocs","additionnalParams","map","name"],"mappings":"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","file":"AHandler.js","sourcesContent":["//\n// Copyright (c) 2016 by Cotep. All Rights Reserved.\n//\n\n// Imports\nimport Utils from '../../Utils/Utils.js';\nimport Errors from '../../Utils/Errors.js';\nimport PromiseCommandPattern from '../../Utils/PromiseCommandPattern.js';\n\n/**\n * This class handle something\n */\nexport default class AHandler {\n  /**\n   * @param {Object} data\n   * @param {{[String]: Class}} mapSomethingConstantAndObject\n   * Map that match the constant of something with the actual Something classes\n   */\n  constructor(data) {\n    // List of available roles\n    // A Something is defined as SINGLETON\n    // A Something can be applied only once\n    this.something = data;\n  }\n\n  /**\n   * Ask something from Something\n   * @param {Number} idRole\n   * @param {Array} args\n   * @param {Function} funcToCall\n   */\n  genericAskingSomethingToDoSomething(idSomething, args, funcToCall) {\n    return new PromiseCommandPattern({\n      func: async () => {\n        // Cannot apply an abstract Something\n        if (idSomething === -1) throw new Errors('E7001');\n\n        // Look in our array if we found the Something\n        const elem = Object.keys(this.something)\n          .find(x => this.something[x].id === idSomething);\n\n        // Cannot find the given id\n        if (!elem) throw new Errors('E7002', `idSomething: ${idSomething}`);\n\n        // If we have no object associated to the Something in the code\n        if (!this.something[elem].obj) throw new Errors('EXXXX', 'Cannot find the object to apply/disable (obj in the code)');\n\n        // try to start the Something\n        return this.something[elem].obj[funcToCall].call(this.something[elem].obj, args);\n      },\n    });\n  }\n\n  /**\n   * Start the given Something\n   * @param {Number} idSomething\n   * @param {Object} args\n   */\n  startSomething(idSomething, args) {\n    return new PromiseCommandPattern({\n      func: () => this.genericAskingSomethingToDoSomething(idSomething, args, 'start'),\n    });\n  }\n\n  /**\n   * Stop the given Something\n   * @param {Number} idSomething\n   * @param {Array} args\n   */\n  stopSomething(idSomething, args) {\n    return new PromiseCommandPattern({\n      func: () => this.genericAskingSomethingToDoSomething(idSomething, args, 'stop'),\n    });\n  }\n\n  /**\n   * Stop all the running Something\n   * @param {?Array} args\n   */\n  stopAllSomething(args = []) {\n    return new PromiseCommandPattern({\n      func: async () => {\n        const objToStop = Object.keys(this.something)\n          .reduce((tmp, x) => {\n            if (this.something[x].obj && this.something[x].obj.isActive()) tmp.push(this.something[x].id);\n\n            return tmp;\n          }, []);\n\n        return Utils.recursiveCallFunction({\n          context: this,\n          func: this.stopSomething,\n          objToIterate: objToStop,\n          nameToSend: null,\n          nameTakenInDocs: null,\n          additionnalParams: args,\n        });\n      },\n    });\n  }\n\n  /**\n   * Get an object using the id of it\n   * @param {String} idSomething\n   */\n  getSomething(idSomething) {\n    return new PromiseCommandPattern({\n      func: async () => {\n        const elem = Object.keys(this.something)\n          .find(x => this.something[x].id === idSomething);\n\n        if (!elem) throw new Errors('EXXXX', `Cannot find obj in the code ${idSomething}`);\n\n        // If we have no object associated to the Something in the code\n        if (!this.something[elem].obj) throw new Errors('EXXXX', `Cannot find obj in the code ${JSON.stringify(this.something[elem])}`);\n\n        return this.something[elem].obj;\n      },\n    });\n  }\n\n  /**\n   * Get all something in array\n   */\n  getAllSomething() {\n    return Object.keys(this.something)\n      .map(x => this.something[x].obj);\n  }\n\n  /**\n   * Get a list of running something status (active or not)\n   */\n  getSomethingListStatus() {\n    return Object.keys(this.something)\n      .reduce((tmp, x) => {\n        if (this.something[x].obj) {\n          return [\n            ...tmp,\n\n            {\n              name: this.something[x].name,\n              id: this.something[x].id,\n              isActive: this.something[x].obj.isActive(),\n            },\n          ];\n        }\n\n        return [\n          ...tmp,\n\n          {\n            name: this.something[x].name,\n            id: this.something[x].id,\n            isActive: false,\n          },\n        ];\n      }, []);\n  }\n}\n"]}