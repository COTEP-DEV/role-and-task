{"version":3,"sources":["../../../src/systemBoot/systemBoot.es6"],"names":["SystemBoot","options","name","CONSTANT","ELIOT_LAUNCHING_PARAMETERS","MODE","alias","type","String","MODE_OPTIONS","multiple","launchingModesMap","LaunchScenarios","getInstance","getMapLaunchingModes","systemInitialization","eliotInitialization","launchMasterSlaveConfigurationFile","PromiseCommandPattern","func","mode","DEFAULT_LAUNCHING_MODE","elem","find","x","Utils","displayMessage","str","Errors","tags","MESSAGE_DISPLAY_TAGS","ERROR","call","RoleAndTask","errorHappened","process","on","PROCESS_EXCEPTION","err","stack","match","UNHANDLED_PROMISE_REJECTION","reason","NODE_WARNING","out","stderr","EventEmitter","defaultMaxListeners","MAX_NUMBER_OF_LISTENER"],"mappings":"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","file":"systemBoot.js","sourcesContent":["//\n// Copyright (c) 2016 by Cotep. All Rights Reserved.\n//\n\n// Imports\nimport EventEmitter from 'events';\nimport commandLineArgs from 'command-line-args';\n\nimport LaunchScenarios from './LaunchScenarios.js';\nimport RoleAndTask from '../RoleAndTask.js';\nimport Utils from '../Utils/Utils.js';\nimport Errors from '../Utils/Errors.js';\nimport CONSTANT from '../Utils/CONSTANT/CONSTANT.js';\nimport PromiseCommandPattern from '../Utils/PromiseCommandPattern.js';\n\n// We are in the main here\nexport default class SystemBoot {\n  /**\n   * Constructor\n   */\n  constructor() {\n    // Do we launch master or slave or oldway?\n    // Get the options\n    this.options = commandLineArgs([{\n      // Theses must be like --mode optA=12 optB=9\n      name: CONSTANT.ELIOT_LAUNCHING_PARAMETERS.MODE.name,\n      alias: CONSTANT.ELIOT_LAUNCHING_PARAMETERS.MODE.alias,\n      type: String,\n    }, {\n      // Theses must be like --mode-options optA=12 optB=9\n      name: CONSTANT.ELIOT_LAUNCHING_PARAMETERS.MODE_OPTIONS.name,\n      alias: CONSTANT.ELIOT_LAUNCHING_PARAMETERS.MODE_OPTIONS.alias,\n      type: String,\n      multiple: true,\n    }]);\n\n    this.launchingModesMap = LaunchScenarios.getInstance()\n      .getMapLaunchingModes();\n  }\n\n  /**\n   * System initialization (not ELIOT)\n   */\n  static systemInitialization() {\n    // We catch uncaught exceptions\n    process.on(CONSTANT.PROCESS_EXCEPTION, (err) => {\n      //\n      // SPECIFIC TO BLESSED PLUGIN\n      //\n      //\n      // Ignore blessed errors because there is a non blocking issue unresolved in the plugin\n      //\n      //\n      if (err && err.stack && err.stack.match(/^.+blessed.+$/im)) return;\n\n      RoleAndTask.getInstance()\n        .errorHappened(err);\n    });\n\n    // We catch unhandled promises\n    process.on(CONSTANT.UNHANDLED_PROMISE_REJECTION, (reason) => {\n      RoleAndTask.getInstance()\n        .errorHappened(new Errors('GENERAL_CATCH', `${String(reason)}`));\n    });\n\n    // We catch warnings\n    process.on(CONSTANT.NODE_WARNING, (reason) => {\n      Utils.displayMessage({\n        str: reason,\n        out: process.stderr,\n      });\n    });\n\n    // Set the maximum number of listeners Default is 11\n    EventEmitter.defaultMaxListeners = CONSTANT.MAX_NUMBER_OF_LISTENER;\n  }\n\n  /**\n   * ELIOT System initialization\n   */\n  static eliotInitialization() {\n    // LaunchScenarios the RoleAndTask initialization\n    RoleAndTask.getInstance();\n  }\n\n  /**\n   * All initializations\n   */\n  initialization() {\n    SystemBoot.systemInitialization();\n\n    SystemBoot.eliotInitialization();\n\n    return this;\n  }\n\n  /**\n   * LaunchScenarios ELIOT\n   */\n  launch(launchMasterSlaveConfigurationFile) {\n    return new PromiseCommandPattern({\n      func: async () => {\n        // Default launch mode\n        if (!this.options.mode) this.options.mode = CONSTANT.DEFAULT_LAUNCHING_MODE;\n\n        // Look if we have a mode that correspond to it\n        const elem = this.launchingModesMap.find(x => x.name === this.options.mode);\n\n        if (!elem) {\n          Utils.displayMessage({\n            str: new Errors('INVALID_LAUNCHING_MODE', 'Invalid launching mode'),\n\n            tags: [\n              CONSTANT.MESSAGE_DISPLAY_TAGS.ERROR,\n            ],\n          });\n\n          return true;\n        }\n\n        try {\n          // LaunchScenarios the thing\n          await elem.func.call(LaunchScenarios.getInstance(), this.options, launchMasterSlaveConfigurationFile);\n        } catch (err) {\n          RoleAndTask.getInstance()\n            .errorHappened(err);\n        }\n\n        return true;\n      },\n    });\n  }\n}\n"]}