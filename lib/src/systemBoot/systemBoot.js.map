{"version":3,"sources":["../../../src/systemBoot/systemBoot.es6"],"names":["SystemBoot","options","name","CONSTANT","PROGRAM_LAUNCHING_PARAMETERS","MODE","alias","type","String","MODE_OPTIONS","multiple","launchingModesMap","LaunchScenarios","getInstance","getMapLaunchingModes","systemInitialization","programInitialization","launchMasterSlaveConfigurationFile","PromiseCommandPattern","func","mode","DEFAULT_LAUNCHING_MODE","elem","find","x","Utils","displayMessage","str","Errors","tags","MESSAGE_DISPLAY_TAGS","ERROR","call","RoleAndTask","errorHappened","process","on","PROCESS_EXCEPTION","err","stack","match","UNHANDLED_PROMISE_REJECTION","reason","NODE_WARNING","out","stderr","considerWarningAsErrors","EventEmitter","defaultMaxListeners","MAX_NUMBER_OF_LISTENER"],"mappings":"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","sourcesContent":["//\n// Copyright (c) 2016 by Cotep. All Rights Reserved.\n//\n\n// Imports\nimport EventEmitter from 'events';\nimport commandLineArgs from 'command-line-args';\n\nimport LaunchScenarios from './LaunchScenarios.js';\nimport RoleAndTask from '../RoleAndTask.js';\nimport Utils from '../Utils/Utils.js';\nimport Errors from '../Utils/Errors.js';\nimport CONSTANT from '../Utils/CONSTANT/CONSTANT.js';\nimport PromiseCommandPattern from '../Utils/PromiseCommandPattern.js';\n\n// We are in the main here\nexport default class SystemBoot {\n  /**\n   * Constructor\n   */\n  constructor() {\n    // Do we launch master or slave or oldway?\n    // Get the options\n    this.options = commandLineArgs([{\n      // Theses must be like --mode optA=12 optB=9\n      name: CONSTANT.PROGRAM_LAUNCHING_PARAMETERS.MODE.name,\n      alias: CONSTANT.PROGRAM_LAUNCHING_PARAMETERS.MODE.alias,\n      type: String,\n    }, {\n      // Theses must be like --mode-options optA=12 optB=9\n      name: CONSTANT.PROGRAM_LAUNCHING_PARAMETERS.MODE_OPTIONS.name,\n      alias: CONSTANT.PROGRAM_LAUNCHING_PARAMETERS.MODE_OPTIONS.alias,\n      type: String,\n      multiple: true,\n    }]);\n\n    this.launchingModesMap = LaunchScenarios.getInstance()\n      .getMapLaunchingModes();\n  }\n\n  /**\n   * System initialization (not PROGRAM)\n   */\n  static systemInitialization() {\n    // We catch uncaught exceptions\n    process.on(CONSTANT.PROCESS_EXCEPTION, (err) => {\n      //\n      // SPECIFIC TO BLESSED PLUGIN\n      //\n      //\n      // Ignore blessed errors because there is a non blocking issue unresolved in the plugin\n      //\n      //\n      if (err && err.stack && err.stack.match(/^.+blessed.+$/im)) return;\n\n      RoleAndTask.getInstance()\n        .errorHappened(err);\n    });\n\n    // We catch unhandled promises\n    process.on(CONSTANT.UNHANDLED_PROMISE_REJECTION, (reason) => {\n      RoleAndTask.getInstance()\n        .errorHappened(new Errors('GENERAL_CATCH', `${String(reason)}`));\n    });\n\n    // We catch warnings\n    process.on(CONSTANT.NODE_WARNING, (reason) => {\n      Utils.displayMessage({\n        str: reason,\n        out: process.stderr,\n      });\n\n      if (RoleAndTask.considerWarningAsErrors) {\n        RoleAndTask.getInstance()\n          .errorHappened(new Errors('GENERAL_CATCH', String(reason)));\n      }\n    });\n\n    // Set the maximum number of listeners Default is 11\n    EventEmitter.defaultMaxListeners = CONSTANT.MAX_NUMBER_OF_LISTENER;\n  }\n\n  /**\n   * PROGRAM System initialization\n   */\n  static programInitialization() {\n    // LaunchScenarios the RoleAndTask initialization\n    RoleAndTask.getInstance();\n  }\n\n  /**\n   * All initializations\n   */\n  initialization() {\n    SystemBoot.systemInitialization();\n\n    SystemBoot.programInitialization();\n\n    return this;\n  }\n\n  /**\n   * LaunchScenarios PROGRAM\n   */\n  launch(launchMasterSlaveConfigurationFile) {\n    return new PromiseCommandPattern({\n      func: async () => {\n        // Default launch mode\n        if (!this.options.mode) this.options.mode = CONSTANT.DEFAULT_LAUNCHING_MODE;\n\n        // Look if we have a mode that correspond to it\n        const elem = this.launchingModesMap.find(x => x.name === this.options.mode);\n\n        if (!elem) {\n          Utils.displayMessage({\n            str: new Errors('INVALID_LAUNCHING_MODE', 'Invalid launching mode'),\n\n            tags: [\n              CONSTANT.MESSAGE_DISPLAY_TAGS.ERROR,\n            ],\n          });\n\n          return true;\n        }\n\n        try {\n          // LaunchScenarios the thing\n          await elem.func.call(LaunchScenarios.getInstance(), this.options, launchMasterSlaveConfigurationFile);\n        } catch (err) {\n          RoleAndTask.getInstance()\n            .errorHappened(err);\n        }\n\n        return true;\n      },\n    });\n  }\n}\n"],"file":"systemBoot.js"}